#!/bin/bash
# Fixup current staged to the given has
# TODO: validate that stage is not empty

# get parameters
while getopts ":r:" opt; do
  case ${opt} in
    r )
      REBASE=true;
      shift;;
    \? )
      echo "Usage: git fixup [-r] <commit hash>"
      echo ${opt}
      ;;
  esac
done

((!$#)) && echo No hash given, command ignored! && exit 1

if ! git rev-parse --quiet --verify "$1"; then
    echo "Invalid hash $1. Command ignored"
    exit 1
fi

git commit -n --fixup=$1

# run the rebase the command to squash commits
if [ $REBASE ]; then
    GIT_SEQUENCE_EDITOR=: git rebase $1~1 -i --autosquash
fi

